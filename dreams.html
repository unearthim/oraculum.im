<!DOCTYPE html>

<html lang="en">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">



    <!-- === 1. Primary Meta Tags (unearth.im Protocol v2.0) === -->

    <title>Dream Interpretation | The Oneiric Oracle</title>

    <meta name="title" content="Dream Interpretation | The Oneiric Oracle">

    <meta name="description" content="Offer your dream to the Oneiric Oracle. Let the foundry unearth its visual sigil and interpret its narrative meaning.">

    <meta name="keywords" content="dream interpretation, dream journal, ai art, oracle, unearth.im, digital monument, gemini, imagen, generative art, oneironaut, sigil, oraculum.im">

    <meta name="author" content="oraculum.im (by unearth heritage foundry - archive & anvil - unearth.im)">

    <meta name="robots" content="index, follow">

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <meta name="language" content="English">



    <!-- === Canonical Link === -->

    <link rel="canonical" href="https://oraculum.im/dreams.html" />



    <!-- === 2. Webmention Endpoint === -->

    <link rel="webmention" href="https://webmention.io/unearth.im/webmention" />



    <!-- === 3. Open Graph / Facebook === -->

    <meta property="og:type" content="website">

    <meta property="og:url" content="https://oraculum.im/dreams.html">

    <meta property="og:title" content="Dream Interpretation | The Oneiric Oracle">

    <meta property="og:description" content="Offer your dream to the Oneiric Oracle. Let the foundry unearth its visual sigil and interpret its narrative meaning.">

    <meta property="og:image" content="https://oraculum.im/og-image.png">

    <meta property="og:site_name" content="The Oneiric Oracle">



    <!-- === 4. Twitter Card === -->

    <meta property="twitter:card" content="summary_large_image">

    <meta property="twitter:url" content="https://oraculum.im/dreams.html">

    <meta property="twitter:title" content="Dream Interpretation | The Oneiric Oracle">

    <meta property="twitter:description" content="Offer your dream to the Oneiric Oracle. Let the foundry unearth its visual sigil and interpret its narrative meaning.">

    <meta property="twitter:image" content="https://oraculum.im/og-image.png">



    <!-- === 5. Favicons === -->

    <link rel="icon" href="/favicon.svg" type="image/svg+xml">

    <link rel="alternate icon" href="/favicon.ico">

    <link rel="apple-touch-icon" href="/apple-touch-icon.png">



    <!-- === 6. Brand Color Meta Tags === -->

    <meta name="theme-color" content="#0F0C29">

    <meta name="msapplication-TileColor" content="#302B63">



    <!-- Tailwind CSS -->

    <script src="https://cdn.tailwindcss.com"></script>

    

    <!-- Google Fonts (unearth.im Standard: Lora & Inter) -->

    <link rel="preconnect" href="https://fonts.googleapis.com">

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Lora:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap" rel="stylesheet">

    

    <style>

        /* Applying new "Oracle" Palette */

        body {

            font-family: 'Lora', serif;

            color: #E0D6FF; /* Light Lavender */

            /* Deep cosmic gradient - now animated! */

            background: linear-gradient(270deg, #0F0C29, #302B63, #24243E, #0F0C29);

            background-size: 400% 400%;

            animation: subtleGradient 25s ease infinite;

        }

        .font-sans {

            font-family: 'Inter', sans-serif;

        }

        .font-serif {

            font-family: 'Lora', serif;

        }

        

        .oracle-focus {

            background-color: rgba(0, 0, 0, 0.2);

            border: 1px solid rgba(167, 139, 250, 0.3); /* Violet-400 with opacity */

            border-radius: 0.75rem;

            box-shadow: 0 10px 25px rgba(0,0,0,0.2), 0 0 30px rgba(167, 139, 250, 0.1);

            backdrop-filter: blur(10px);

            -webkit-backdrop-filter: blur(10px);

        }



        .oracle-textarea {

            background-color: rgba(17, 24, 39, 0.6); /* Gray-900 with opacity */

            border: 1px solid rgba(129, 140, 163, 0.4); /* Gray-600 with opacity */

            color: #F3F4F6; /* Gray-100 */

            border-radius: 0.5rem;

        }

        .oracle-textarea:focus {

            outline: none;

            border-color: #A78BFA; /* Violet-400 */

            box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.3);

        }

        .oracle-textarea::placeholder {

            color: #9CA3AF; /* Gray-400 */

        }



        .oracle-button {

            background-color: #7C3AED; /* Violet-600 */

            color: #FFFFFF;

            transition: all 0.2s ease-in-out;

            border-radius: 0.5rem;

            box-shadow: 0 4px 15px rgba(124, 58, 237, 0.2);

        }

        .oracle-button:hover {

            background-color: #8B5CF6; /* Violet-500 */

            box-shadow: 0 6px 20px rgba(124, 58, 237, 0.3);

            transform: translateY(-1px);

        }

        .oracle-button:disabled {

            background-color: #4B5563; /* Gray-600 */

            color: #9CA3AF; /* Gray-400 */

            cursor: not-allowed;

            box-shadow: none;

        }



        /* New secondary button style for downloads */

        .oracle-button-secondary {

            background-color: transparent;

            color: #A78BFA; /* Violet-400 */

            border: 1px solid #A78BFA;

            transition: all 0.2s ease-in-out;

            border-radius: 0.5rem;

            padding: 0.5rem 1rem; /* Smaller padding */

            font-size: 0.875rem; /* Smaller font */

            font-family: 'Inter', sans-serif;

            font-weight: 500;

            margin-top: 0.75rem; /* 12px */

        }

        .oracle-button-secondary:hover {

            background-color: rgba(167, 139, 250, 0.1);

            color: #C4B5FD; /* Violet-300 */

        }

        

        .loader {

            border: 4px solid #374151; /* Gray-700 */

            border-top: 4px solid #A78BFA; /* Violet-400 */

            border-radius: 50%;

            width: 48px;

            height: 48px;

            animation: spin 1s linear infinite;

        }

        @keyframes spin {

            0% { transform: rotate(0deg); }

            100% { transform: rotate(360deg); }

        }



        /* New keyframe animation for the background */

        @keyframes subtleGradient {

            0% { background-position: 0% 50%; }

            50% { background-position: 100% 50%; }

            100% { background-position: 0% 50%; }

        }



        .sigil-container {

            background-color: rgba(0, 0, 0, 0.2);

            border: 1px solid rgba(167, 139, 250, 0.2);

        }

        .whisper-box {

            background-color: rgba(0, 0, 0, 0.1);

            border: 1px dashed rgba(167, 139, 250, 0.4);

        }

        

        .title-glow {

            text-shadow: 0 0 8px rgba(224, 214, 255, 0.3), 0 0 20px rgba(167, 139, 250, 0.3);

        }

        

        .fade-in {

            animation: fadeIn 0.8s ease-in-out;

        }

        @keyframes fadeIn {

            from { opacity: 0; }

            to { opacity: 1; }

        }

    </style>

</head>

<body class="antialiased">



    <div class="min-h-screen flex flex-col items-center justify-center p-4 py-12">

        <header class="text-center mb-10 max-w-2xl mx-auto">

            <h1 class="font-serif text-4xl md:text-6xl font-bold text-white tracking-tight title-glow">The Oneiric Oracle</h1>

            <p class="font-sans text-lg text-purple-200 mt-2">A Vessel for Visions of the Subconscious</p>

        </header>



        <!-- New introductory paragraph -->

        <div class="max-w-xl mx-auto text-center mb-10 px-4">

            <p class="font-sans text-base md:text-lg text-purple-200 leading-relaxed">

                Offer a fragment of your slumber to the void. The Oracle will first cast a visual sigil from its essence, then return a whisperâ€”a narrative interpretation of the vision you've shared.

            </p>

        </div>



        <main class="w-full max-w-2xl oracle-focus p-6 md:p-8">

            

            <form id="dream-form">

                <label for="dream-input" class="font-sans text-base font-semibold text-purple-200 mb-2 block">Describe the echoes of your dream:</label>

                <textarea id="dream-input" class="oracle-textarea w-full px-4 py-3 text-base h-36" placeholder="I saw a serpent of stars..."></textarea>

                <button type="submit" id="generate-button" class="oracle-button font-bold py-3 px-5 w-full mt-4 font-sans text-lg">

                    Consult the Oracle

                </button>

            </form>



            <!-- Results Section -->

            <div id="results-container" class="mt-8 space-y-8">

                

                <!-- Artifact (Image) -->

                <div id="artifact-section" class="hidden">

                    <h2 class="font-serif text-2xl font-bold text-purple-300 mb-4">The Waking Sigil</h2>

                    <div id="image-display" class="sigil-container w-full aspect-square rounded-lg flex items-center justify-center">

                        <p id="placeholder-text" class="text-gray-400 font-sans">The void gazes back...</p>

                        <!-- Loader and Image will be injected here -->

                    </div>

                    <button id="download-image-button" class="oracle-button-secondary hidden w-full md:w-auto">

                        Download Sigil (.png)

                    </button>

                </div>



                <!-- Interpretation (Text) -->

                <div id="interpretation-section" class="hidden">

                    <h2 class="font-serif text-2xl font-bold text-purple-300 mb-4">The Oracle's Whisper</h2>

                    <div id="interpretation-display" class="whisper-box w-full p-6 rounded-lg">

                        <p id="interpretation-text" class="text-purple-100 text-lg leading-relaxed italic">The Oracle deciphers the vision...</p>

                    </div>

                    <button id="save-text-button" class="oracle-button-secondary hidden w-full md:w-auto">

                        Save Whisper (.txt)

                    </button>

                </div>



            </div>



        </main>



        <footer class="text-center pt-12 text-gray-400 font-sans">

            <p>a digital monument by <a href="https://unearth.im" target="_blank" rel="noopener noreferrer" class="hover:text-purple-300 transition">unearth.im</a></p>

        </footer>

    </div>



    <script>

        document.addEventListener('DOMContentLoaded', () => {

            // === CONFIGURATION ===

            // Using your current proxy URL from shared info

            const PROXY_URL = "https://genartproxy-ce7zb66hpq-uc.a.run.app";

            

            // --- DOM Elements ---

            const dreamForm = document.getElementById('dream-form');

            const dreamInput = document.getElementById('dream-input');

            const generateButton = document.getElementById('generate-button');

            const resultsContainer = document.getElementById('results-container');

            

            // Artifact Elements

            const artifactSection = document.getElementById('artifact-section');

            const imageDisplay = document.getElementById('image-display');

            const placeholderText = document.getElementById('placeholder-text');



            // Interpretation Elements

            const interpretationSection = document.getElementById('interpretation-section');

            const interpretationDisplay = document.getElementById('interpretation-display');

            const interpretationText = document.getElementById('interpretation-text');



            // Download Elements

            const downloadImageButton = document.getElementById('download-image-button');

            const saveTextButton = document.getElementById('save-text-button');



            // --- State Variables ---

            let currentImageUrl = null; // Store image data URL

            let currentInterpretationText = null; // Store interpretation text



            /**

             * Handles the full two-step dream interpretation process

             */

            dreamForm.addEventListener('submit', async (e) => {

                e.preventDefault();

                const prompt = dreamInput.value.trim();

                if (!prompt) return;



                // --- 1. SET UP UI FOR LOADING ---

                generateButton.disabled = true;

                generateButton.textContent = 'Scrying...';

                

                // Hide download buttons on new submission

                downloadImageButton.classList.add('hidden');

                saveTextButton.classList.add('hidden');



                // Show artifact loader

                artifactSection.classList.remove('hidden');

                artifactSection.classList.add('fade-in');

                imageDisplay.innerHTML = '<div class="loader"></div>';

                

                // Show interpretation loader

                interpretationSection.classList.remove('hidden');

                interpretationSection.classList.add('fade-in');

                interpretationText.textContent = 'The Oracle deciphers the vision...';



                let base64Data = null;



                try {

                    // --- 2. STEP 1: GENERATE THE IMAGE ---

                    console.log("Step 1: Calling proxy for sigil generation...");

                    // This payload assumes the proxy's "generateImage" mode

                    // is set up to handle this specific simple format.

                    const imagePayload = {

                        mode: "generateImage",

                        payload: { prompt: prompt }

                    };



                    const imageResponse = await fetch(PROXY_URL, {

                        method: 'POST',

                        headers: { 'Content-Type': 'application/json' },

                        body: JSON.stringify(imagePayload)

                    });



                    if (!imageResponse.ok) {

                        const errorData = await imageResponse.json();

                        throw new Error(errorData.details?.error?.message || errorData.error || "Image generation failed.");

                    }

                    

                    const imageResult = await imageResponse.json();

                    base64Data = imageResult.predictions?.[0]?.bytesBase64Encoded;



                    if (base64Data) {

                        const imageUrl = `data:image/png;base64,${base64Data}`;

                        currentImageUrl = imageUrl; // Store for download

                        imageDisplay.innerHTML = `<img src="${imageUrl}" alt="Dream sigil for: ${prompt}" class="w-full h-full object-cover rounded-lg fade-in">`;

                        downloadImageButton.classList.remove('hidden'); // Show image download button

                    } else {

                        throw new Error("No image data received from API.");

                    }



                    // --- 3. STEP 2: INTERPRET THE DREAM (IMAGE + TEXT) ---

                    console.log("Step 2: Calling proxy for oracle interpretation...");



                    // **FIX**: Simplify the payload for the proxy's 'interpretDream' mode.

                    // The proxy likely builds the complex Gemini request on the server

                    // from these simpler fields.

                    const interpretationPayload = {

                        mode: "interpretDream",

                        payload: {

                            prompt: prompt, // The original dream text

                            base64Data: base64Data, // The generated image

                            // Pass the system instruction as a simple string.

                            // The proxy can wrap it in the required 'parts' structure.

                            systemInstruction: "You are The Oneiric Oracle. A user has given you a description of their dream and an AI-generated image (a 'sigil') based on that dream. Your task is to provide a brief, mystical, and insightful interpretation of the dream, drawing upon both the text and the imagery. Speak in the voice of a wise, ancient oracle. Be poetic and symbolic, but understandable and accessible, not clinical."

                        }

                    };



                    const interpretationResponse = await fetch(PROXY_URL, {

                        method: 'POST',

                        headers: { 'Content-Type': 'application/json' },

                        body: JSON.stringify(interpretationPayload)

                    });



                    if (!interpretationResponse.ok) {

                        const errorData = await interpretationResponse.json();

                        // Check for the specific error message and re-throw it

                        const errorMessage = errorData.details?.error?.message || errorData.error || "Interpretation failed.";

                        throw new Error(errorMessage);

                    }



                    const interpretationResult = await interpretationResponse.json();

                    const text = interpretationResult.candidates?.[0]?.content?.parts?.[0]?.text;



                    if (text) {

                        currentInterpretationText = text; // Store for download

                        // Convert simple markdown italics to HTML emphasis

                        const formattedText = markdownToHtml(text);

                        interpretationText.innerHTML = formattedText; // Use innerHTML to render the <em> tags

                        saveTextButton.classList.remove('hidden'); // Show text save button

                    } else {

                        throw new Error("No interpretation text received.");

                    }



                } catch (error) {

                    console.error("Oracle Error:", error);

                    imageDisplay.innerHTML = `<p class="text-red-400 p-4 text-center font-sans">The vision is clouded. Please try another dream. <br><span class="text-xs">${error.message}</span></p>`;

                    interpretationText.textContent = "The Oracle is silent. The connection was lost.";

                } finally {

                    generateButton.disabled = false;

                    generateButton.textContent = 'Consult the Oracle';

                }

            });



            /**

             * Converts simple Markdown italics (*text*) to HTML emphasis (<em>text</em>).

             */

            function markdownToHtml(text) {
                // Convert markdown to proper HTML
                let html = text;
                
                // Headers (### becomes <h3>, ## becomes <h2>, # becomes <h1>)
                html = html.replace(/^### (.+)$/gm, '<h3>$1</h3>');
                html = html.replace(/^## (.+)$/gm, '<h2>$1</h2>');
                html = html.replace(/^# (.+)$/gm, '<h1>$1</h1>');
                
                // Bold and italic combined (***text*** or ___text___)
                html = html.replace(/\*\*\*(.+?)\*\*\*/g, '<strong><em>$1</em></strong>');
                html = html.replace(/___(.+?)___/g, '<strong><em>$1</em></strong>');
                
                // Bold (**text** or __text__)
                html = html.replace(/\*\*(.+?)\*\*(?!\*)/g, '<strong>$1</strong>');
                html = html.replace(/__(.+?)__(?!_)/g, '<strong>$1</strong>');
                
                // Italic (*text* or _text_) - do this last to avoid conflicts
                html = html.replace(/\*([^*\n]+?)\*(?!\*)/g, '<em>$1</em>');
                html = html.replace(/_([^_\n]+?)_(?!_)/g, '<em>$1</em>');
                
                // Line breaks - convert double newlines to paragraph breaks
                html = html.split('\n\n').map(para => {
                    if (para.trim().startsWith('<h')) {
                        return para; // Don't wrap headers in <p>
                    }
                    return '<p>' + para.replace(/\n/g, '<br>') + '</p>';
                }).join('\n');
                
                return html;
            }



            // --- Download Listeners ---



            downloadImageButton.addEventListener('click', () => {

                if (!currentImageUrl) return;

                const link = document.createElement('a');

                link.href = currentImageUrl;

                link.download = 'oneiric_sigil.png'; // Filename

                document.body.appendChild(link);

                link.click();

                document.body.removeChild(link);

            });



            saveTextButton.addEventListener('click', () => {

                const dreamText = dreamInput.value.trim();

                if (!currentInterpretationText || !dreamText) return;



                // Format the text for the .txt file

                const fullText = `DREAM FRAGMENT:\n====================\n${dreamText}\n\n\nORACLE'S WHISPER:\n====================\n${currentInterpretationText}`;

                

                const blob = new Blob([fullText], { type: 'text/plain;charset=utf-8' });

                const url = URL.createObjectURL(blob);

                

                const link = document.createElement('a');

                link.href = url;

                link.download = 'oneiric_whisper.txt'; // Filename

                document.body.appendChild(link);

                link.click();

                document.body.removeChild(link);

                URL.revokeObjectURL(url); // Clean up blob URL

            });

        });

    </script>

</body>

</html>